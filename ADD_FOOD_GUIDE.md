# ðŸ“– æ·»åŠ é£Ÿç‰©æ•°æ®æŒ‡å—

å¦‚ä½•å‘RAGå‘é‡æ•°æ®åº“ä¸­æ·»åŠ æ–°çš„é£Ÿç‰©æ•°æ®ã€‚

## ðŸŽ¯ æ–¹æ³•ä¸€ï¼šäº¤äº’å¼æ·»åŠ ï¼ˆæŽ¨èæ–°æ‰‹ï¼‰

### æ­¥éª¤ 1: æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œäº¤äº’å¼æ·»åŠ å·¥å…·

```powershell
python manage_menu.py add
```

### æ­¥éª¤ 2: æŒ‰æç¤ºå¡«å†™ä¿¡æ¯

ç³»ç»Ÿä¼šè¯¢é—®ä»¥ä¸‹ä¿¡æ¯ï¼š

```
ID: custom_016              # è‡ªåŠ¨ç”Ÿæˆï¼Œç›´æŽ¥å›žè½¦å³å¯
é£Ÿç‰©åç§°: é¸¡èƒ¸è‚‰æ²™æ‹‰
é£Ÿå ‚åç§°: ä¸­å¿ƒé£Ÿå ‚
ç±»åˆ«: ç´ èœ                   # ä¸»é£Ÿ/è¤èœ/ç´ èœ/æ±¤/æ—©é¤/é¥®å“
ä»·æ ¼ (å…ƒ): 15
å¡è·¯é‡Œ (kcal): 280
è›‹ç™½è´¨ (g): 35
ç¢³æ°´åŒ–åˆç‰© (g): 20
è„‚è‚ª (g): 5
ä¸»è¦é£Ÿæ (é€—å·åˆ†éš”): é¸¡èƒ¸è‚‰,ç”Ÿèœ,ç•ªèŒ„,é»„ç“œ
æ ‡ç­¾ (é€—å·åˆ†éš”): å‡è„‚,é«˜è›‹ç™½,ä½Žè„‚,å¥åº·
ä¾›åº”æ—¶æ®µ (æ—©é¤/åˆé¤/æ™šé¤ï¼Œé€—å·åˆ†éš”): åˆé¤,æ™šé¤
æè¿° (å¯é€‰): æ–°é²œé¸¡èƒ¸è‚‰é…è”¬èœæ²™æ‹‰ï¼Œé€‚åˆå‡è„‚äººç¾¤
```

### æ­¥éª¤ 3: ç¡®è®¤å¹¶ä¿å­˜

```
ç¡®è®¤æ·»åŠ ? (y/n): y
```

### æ­¥éª¤ 4: æ›´æ–°æ•°æ®åº“

```powershell
python init_db.py
```

---

## ðŸš€ æ–¹æ³•äºŒï¼šæ‰¹é‡æ·»åŠ ï¼ˆæŽ¨èé«˜çº§ç”¨æˆ·ï¼‰

### æ­¥éª¤ 1: ç¼–è¾‘ JSON æ–‡ä»¶

æ‰“å¼€ `data/canteens/sample_menu.json`ï¼Œæ·»åŠ æ–°çš„é£Ÿç‰©å¯¹è±¡ï¼š

```json
{
  "id": "c1_016",
  "name": "çƒ¤é¸¡èƒ¸è‚‰",
  "canteen": "ä¸­å¿ƒé£Ÿå ‚",
  "category": "è¤èœ",
  "price": 18.0,
  "nutrition": {
    "calories": 350,
    "protein": 45,
    "carbs": 12,
    "fat": 8
  },
  "ingredients": ["é¸¡èƒ¸è‚‰", "æ©„æ¦„æ²¹", "é»‘èƒ¡æ¤’"],
  "tags": ["é«˜è›‹ç™½", "ä½Žè„‚", "å¢žè‚Œ", "å¥åº·"],
  "available_meals": ["åˆé¤", "æ™šé¤"],
  "description": "é¦™çƒ¤é¸¡èƒ¸è‚‰ï¼Œè›‹ç™½è´¨å«é‡é«˜ï¼Œé€‚åˆå¥èº«äººç¾¤"
}
```

### æ­¥éª¤ 2: æ›´æ–°æ•°æ®åº“

```powershell
python init_db.py
```

---

## ðŸ“‹ å­—æ®µè¯´æ˜Ž

| å­—æ®µ | ç±»åž‹ | å¿…å¡« | è¯´æ˜Ž | ç¤ºä¾‹ |
|-----|------|-----|------|-----|
| `id` | string | âœ… | å”¯ä¸€æ ‡è¯†ç¬¦ | "c1_016" |
| `name` | string | âœ… | é£Ÿç‰©åç§° | "é¸¡èƒ¸è‚‰æ²™æ‹‰" |
| `canteen` | string | âœ… | é£Ÿå ‚åç§° | "ä¸­å¿ƒé£Ÿå ‚" |
| `category` | string | âœ… | ç±»åˆ« | "ä¸»é£Ÿ/è¤èœ/ç´ èœ/æ±¤/æ—©é¤/é¥®å“" |
| `price` | number | âœ… | ä»·æ ¼ï¼ˆå…ƒï¼‰ | 15.0 |
| `nutrition.calories` | number | âœ… | å¡è·¯é‡Œ (kcal) | 280 |
| `nutrition.protein` | number | âœ… | è›‹ç™½è´¨ (g) | 35 |
| `nutrition.carbs` | number | âœ… | ç¢³æ°´åŒ–åˆç‰© (g) | 20 |
| `nutrition.fat` | number | âœ… | è„‚è‚ª (g) | 5 |
| `ingredients` | array | âœ… | ä¸»è¦é£Ÿæ | ["é¸¡èƒ¸è‚‰", "ç”Ÿèœ"] |
| `tags` | array | âœ… | æ ‡ç­¾ | ["å‡è„‚", "é«˜è›‹ç™½"] |
| `available_meals` | array | âœ… | ä¾›åº”æ—¶æ®µ | ["åˆé¤", "æ™šé¤"] |
| `description` | string | âŒ | æè¿° | "é€‚åˆå‡è„‚äººç¾¤" |

---

## ðŸ·ï¸ å¸¸ç”¨æ ‡ç­¾å‚è€ƒ

### å¥åº·ç›®æ ‡
- `å‡è„‚` - ä½Žå¡è·¯é‡Œé£Ÿç‰©
- `å¢žè‚Œ` - é«˜è›‹ç™½é£Ÿç‰©
- `å¥åº·` - è¥å…»å‡è¡¡
- `æ¸…æ·¡` - å°‘æ²¹å°‘ç›

### è¥å…»ç‰¹ç‚¹
- `é«˜è›‹ç™½` - è›‹ç™½è´¨ > 15g
- `ä½Žè„‚` - è„‚è‚ª < 10g
- `ä½Žå¡` - å¡è·¯é‡Œ < 400kcal
- `é«˜çº¤ç»´` - å¯Œå«è†³é£Ÿçº¤ç»´

### é£Ÿæç‰¹ç‚¹
- `ç´ é£Ÿ` - å…¨ç´ é£Ÿ
- `æµ·é²œ` - å«æµ·é²œ
- `è‚‰ç±»` - å«è‚‰ç±»
- `è¾£` - è¾›è¾£é£Ÿç‰©

### ç‰¹æ®Šéœ€æ±‚
- `å¿«æ‰‹` - å¿«é€Ÿå‡ºé¤
- `ç»æµŽå®žæƒ ` - ä»·æ ¼ä½ŽäºŽ10å…ƒ
- `ç‰¹è‰²` - ç‰¹è‰²èœå“

---

## ðŸ”§ ç®¡ç†å·¥å…·å‘½ä»¤

### æŸ¥çœ‹æ‰€æœ‰é£Ÿç‰©
```powershell
python manage_menu.py list
```

### æŸ¥çœ‹ç‰¹å®šé£Ÿå ‚é£Ÿç‰©
```powershell
python manage_menu.py list ä¸­å¿ƒé£Ÿå ‚
```

### æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
```powershell
python manage_menu.py stats
```

### åˆ é™¤é£Ÿç‰©
```powershell
python manage_menu.py remove c1_016
```

---

## ðŸ’¡ æ‰¹é‡æ·»åŠ ç¤ºä¾‹

åˆ›å»ºä¸€ä¸ªæ–°çš„ JSON æ–‡ä»¶ `data/canteens/new_foods.json`ï¼š

```json
[
  {
    "id": "c2_001",
    "name": "ä¸‰æ–‡é±¼åˆºèº«é¥­",
    "canteen": "å—é—¨é£Ÿå ‚",
    "category": "ä¸»é£Ÿ",
    "price": 28.0,
    "nutrition": {
      "calories": 520,
      "protein": 32,
      "carbs": 58,
      "fat": 15
    },
    "ingredients": ["ä¸‰æ–‡é±¼", "ç±³é¥­", "æµ·è‹”", "èŠéº»"],
    "tags": ["é«˜è›‹ç™½", "æµ·é²œ", "æ—¥å¼", "å¥åº·"],
    "available_meals": ["åˆé¤", "æ™šé¤"],
    "description": "æ–°é²œä¸‰æ–‡é±¼é…æ—¥å¼ç±³é¥­"
  },
  {
    "id": "c2_002",
    "name": "ç‰›æ²¹æžœå¥¶æ˜”",
    "canteen": "å—é—¨é£Ÿå ‚",
    "category": "é¥®å“",
    "price": 12.0,
    "nutrition": {
      "calories": 220,
      "protein": 4,
      "carbs": 25,
      "fat": 12
    },
    "ingredients": ["ç‰›æ²¹æžœ", "ç‰›å¥¶", "èœ‚èœœ"],
    "tags": ["å¥åº·", "é¥®å“", "ç´ é£Ÿ"],
    "available_meals": ["æ—©é¤", "åˆé¤", "æ™šé¤"],
    "description": "è¥å…»ä¸°å¯Œçš„ç‰›æ²¹æžœå¥¶æ˜”"
  }
]
```

ç„¶åŽåˆ›å»ºä¸€ä¸ªå¯¼å…¥è„šæœ¬ï¼š

```python
# import_new_foods.py
import json
from manage_menu import MenuManager

manager = MenuManager()

with open("data/canteens/new_foods.json", "r", encoding="utf-8") as f:
    new_foods = json.load(f)

for food in new_foods:
    manager.add_food(food)

print(f"âœ… å¯¼å…¥å®Œæˆï¼å…±æ·»åŠ  {len(new_foods)} ä¸ªé£Ÿç‰©")
```

è¿è¡Œå¯¼å…¥ï¼š
```powershell
python import_new_foods.py
python init_db.py
```

---

## ðŸŽ¨ è¥å…»è®¡ç®—å‚è€ƒ

### æ ‡å‡†å‚è€ƒå€¼

| é¤æ¬¡ | å»ºè®®å¡è·¯é‡Œ | è›‹ç™½è´¨ | ç¢³æ°´ | è„‚è‚ª |
|-----|-----------|--------|------|------|
| æ—©é¤ | 400-500 | 15-20g | 50-60g | 10-15g |
| åˆé¤ | 600-800 | 25-35g | 70-90g | 15-25g |
| æ™šé¤ | 500-700 | 20-30g | 60-80g | 12-20g |

### ä¸åŒç›®æ ‡çš„è¥å…»é…æ¯”

**å‡è„‚æœŸï¼š**
- å¡è·¯é‡Œï¼š400-600 kcal/é¤
- è›‹ç™½è´¨ï¼š30-40% (é«˜)
- ç¢³æ°´ï¼š30-40% (ä¸­)
- è„‚è‚ªï¼š20-30% (ä½Ž)

**å¢žè‚ŒæœŸï¼š**
- å¡è·¯é‡Œï¼š700-900 kcal/é¤
- è›‹ç™½è´¨ï¼š30-35% (é«˜)
- ç¢³æ°´ï¼š45-50% (é«˜)
- è„‚è‚ªï¼š15-25% (ä¸­)

**ç»´æŒæœŸï¼š**
- å¡è·¯é‡Œï¼š500-700 kcal/é¤
- è›‹ç™½è´¨ï¼š25-30%
- ç¢³æ°´ï¼š45-55%
- è„‚è‚ªï¼š20-25%

---

## ðŸ” æµ‹è¯•æ·»åŠ çš„é£Ÿç‰©

æ·»åŠ é£Ÿç‰©åŽï¼Œæµ‹è¯•æ˜¯å¦èƒ½è¢«æ­£ç¡®æ£€ç´¢ï¼š

```python
# test_search.py
from app.database import get_vector_db

vector_db = get_vector_db()

# æœç´¢æµ‹è¯•
results = vector_db.search_foods("å‡è„‚ é«˜è›‹ç™½ é¸¡è‚‰", n_results=5)

print(f"æ‰¾åˆ° {len(results)} ä¸ªç»“æžœï¼š\n")
for i, food in enumerate(results, 1):
    print(f"{i}. {food.name}")
    print(f"   é£Ÿå ‚: {food.canteen}")
    print(f"   è¥å…»: {food.nutrition.calories}kcal, "
          f"{food.nutrition.protein}gè›‹ç™½è´¨")
    print(f"   æ ‡ç­¾: {', '.join(food.tags)}\n")
```

è¿è¡Œæµ‹è¯•ï¼š
```powershell
python test_search.py
```

---

## ðŸ“Š å½“å‰æ•°æ®åº“çŠ¶æ€

æŸ¥çœ‹å½“å‰æœ‰å¤šå°‘é£Ÿç‰©ï¼š

```powershell
python -c "from app.database import get_vector_db; db = get_vector_db(); print(f'å½“å‰æ•°æ®åº“æœ‰ {db.count()} ä¸ªé£Ÿç‰©')"
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ID å¿…é¡»å”¯ä¸€**ï¼šæ¯ä¸ªé£Ÿç‰©çš„ ID ä¸èƒ½é‡å¤
2. **è¥å…»æ•°æ®å‡†ç¡®æ€§**ï¼šå°½é‡å‚è€ƒçœŸå®žè¥å…»æˆåˆ†
3. **æ ‡ç­¾ä¸€è‡´æ€§**ï¼šä½¿ç”¨ç»Ÿä¸€çš„æ ‡ç­¾åç§°ï¼ˆå¦‚"å‡è„‚"è€Œéž"å‡è‚¥"ï¼‰
4. **å®šæœŸå¤‡ä»½**ï¼šä¿®æ”¹å‰å¤‡ä»½ `sample_menu.json`
5. **æ›´æ–°æ•°æ®åº“**ï¼šæ¯æ¬¡ä¿®æ”¹ JSON åŽå¿…é¡»è¿è¡Œ `python init_db.py`

---

## ðŸ†˜ å¸¸è§é—®é¢˜

**Q: æ·»åŠ é£Ÿç‰©åŽæœç´¢ä¸åˆ°ï¼Ÿ**
A: ç¡®ä¿è¿è¡Œäº† `python init_db.py` æ›´æ–°å‘é‡æ•°æ®åº“

**Q: ID å†²çªæ€Žä¹ˆåŠžï¼Ÿ**
A: ä½¿ç”¨ `python manage_menu.py list` æŸ¥çœ‹çŽ°æœ‰ IDï¼Œé€‰æ‹©æœªä½¿ç”¨çš„

**Q: å¦‚ä½•æ‰¹é‡å¯¼å…¥ Excel æ•°æ®ï¼Ÿ**
A: å¯ä»¥ä½¿ç”¨ pandas è¯»å– Excel å¹¶è½¬æ¢ä¸º JSON æ ¼å¼

**Q: è¥å…»æ•°æ®ä¸å‡†ç¡®æ€Žä¹ˆåŠžï¼Ÿ**
A: å‚è€ƒé£Ÿå“æˆåˆ†è¡¨æˆ–ä¸“ä¸šè¥å…»æ•°æ®åº“ï¼ˆå¦‚ USDAï¼‰

---

## ðŸ“š æ‰©å±•é˜…è¯»

- [ä¸­å›½é£Ÿç‰©æˆåˆ†è¡¨](http://www.chinanutri.cn/)
- [USDA FoodData Central](https://fdc.nal.usda.gov/)
- [ChromaDB æ–‡æ¡£](https://docs.trychroma.com/)

---

**æœ€åŽä¸€æ­¥ï¼šè®°å¾—é‡å¯æœåŠ¡å™¨ï¼**

```powershell
# Ctrl+C åœæ­¢å½“å‰æœåŠ¡å™¨
uvicorn app.main:app --reload
```

çŽ°åœ¨æ–°æ·»åŠ çš„é£Ÿç‰©å°±èƒ½è¢« AI æŽ¨èå•¦ï¼ ðŸŽ‰
